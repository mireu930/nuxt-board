import { defineEventHandler, readBody } from 'file://C:/my-app/nuxt-board/node_modules/h3/dist/index.mjs';
import bcrypt from 'file://C:/my-app/nuxt-board/node_modules/bcrypt/bcrypt.js';
import { g as getDbPool } from '../../../_/db.mjs';
import 'file://C:/my-app/nuxt-board/node_modules/mysql2/promise.js';

const register_post = defineEventHandler(async (event) => {
  try {
    const body = await readBody(event);
    if (!body.userid || !body.name || !body.password || !body.email) {
      return {
        success: false,
        error: "\uD544\uC218 \uD56D\uBAA9\uC744 \uBAA8\uB450 \uC785\uB825\uD574\uC8FC\uC138\uC694."
      };
    }
    const pool = getDbPool();
    const [existing] = await pool.query(
      "SELECT userid FROM nextict_tbl_user WHERE userid = ?",
      [body.userid]
    );
    if (existing.length > 0) {
      return {
        success: false,
        error: "\uC774\uBBF8 \uC0AC\uC6A9\uC911\uC778 \uC544\uC774\uB514\uC785\uB2C8\uB2E4."
      };
    }
    const hashedPassword = await bcrypt.hash(body.password, 10);
    const hobbies = Array.isArray(body.hobbies) ? body.hobbies.join(",") : body.hobbies;
    await pool.query(
      "INSERT INTO nextict_tbl_user (userid, name, password, email, job, hobbies, gender, social) VALUES (?, ?, ?, ?, ?, ?, ?, 0)",
      [body.userid, body.name, hashedPassword, body.email, body.job, hobbies, body.gender]
    );
    return {
      success: true,
      message: "\uD68C\uC6D0\uAC00\uC785\uC774 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4."
    };
  } catch (error) {
    console.error("Register error:", error);
    return {
      success: false,
      error: error.message
    };
  }
});

export { register_post as default };
//# sourceMappingURL=register.post.mjs.map
